---
import FunnelLayout from '../layouts/FunnelLayout.astro';
---

<FunnelLayout title="Cerere OfertÄƒ 2026 - Safety Academy">
  <div class="bg-white w-full max-w-lg p-6 md:p-10 border-l-8 border-[#FF6B00]">
    <!-- Header -->
    <div class="border-b border-gray-100 pb-6 mb-6">
      <span class="text-[#FF6B00] font-bold text-xs tracking-[0.2em] uppercase block mb-1">
        Safety Academy
      </span>
      <h1 class="text-2xl font-extrabold text-gray-900 m-0">
        Cerere OfertÄƒ 2026
      </h1>
      <p class="text-gray-500 text-sm mt-2">
        Echipa este Ã®n vacanÈ›Äƒ. PreluÄƒm cererile pentru Ianuarie.
      </p>
    </div>

    <!-- Form -->
    <iframe name="hidden_iframe_cerere" id="hidden_iframe_cerere" style="display:none;"></iframe>
    <form 
      id="reqForm" 
      action="https://docs.google.com/forms/d/e/1FAIpQLSe1N-Oh2HCEfZWnHQF4y5RfCk9azhTeKkh2EjGq2QTXGAriNA/formResponse" 
      method="POST"
      target="hidden_iframe_cerere"
      class="space-y-4"
    >
      <div>
        <label class="block text-sm font-bold text-gray-700 mb-2">Numele TÄƒu</label>
        <input
          name="entry.720529008"
          id="inputName"
          type="text"
          required
          class="w-full p-3 border border-gray-300 bg-white text-gray-900 focus:border-[#FF6B00] focus:ring-1 focus:ring-[#FF6B00] outline-none"
        />
      </div>

      <div>
        <label class="block text-sm font-bold text-gray-700 mb-2">Email Business</label>
        <input
          name="entry.576847258"
          id="inputEmail"
          type="email"
          required
          class="w-full p-3 border border-gray-300 bg-white text-gray-900 focus:border-[#FF6B00] focus:ring-1 focus:ring-[#FF6B00] outline-none"
          oninput="document.getElementById('googleEmail').value = this.value"
        />
        <input type="hidden" name="emailAddress" id="googleEmail" />
      </div>

      <div>
        <label class="block text-sm font-bold text-gray-700 mb-2">Telefon</label>
        <input
          name="entry.2114265590"
          id="inputPhone"
          type="tel"
          required
          class="w-full p-3 border border-gray-300 bg-white text-gray-900 focus:border-[#FF6B00] focus:ring-1 focus:ring-[#FF6B00] outline-none"
        />
      </div>

      <div>
        <label class="block text-sm font-bold text-gray-700 mb-2">Detalii Solicitare</label>
        <textarea
          name="entry.1137760832"
          id="inputMsg"
          rows="3"
          required
          placeholder="Ce cursuri vÄƒ intereseazÄƒ?"
          class="w-full p-3 border border-gray-300 bg-white text-gray-900 focus:border-[#FF6B00] focus:ring-1 focus:ring-[#FF6B00] outline-none"
        ></textarea>
      </div>
      
      <!-- Hidden Source -->
      <input type="hidden" name="entry.268772384" value="Request Form Medium" />

      <button
        type="submit"
        id="reqBtn"
        class="w-full bg-[#111827] hover:bg-[#FF6B00] text-white font-bold py-3.5 px-4 mt-4 transition-colors duration-300"
      >
        Trimite Cererea
      </button>
    </form>

    <!-- Success Message -->
    <div id="reqSuccess" class="hidden text-center py-8">
      <div class="text-xl font-bold text-gray-900 mb-2">ğŸ‘ Mesaj Primit!</div>
      <p class="text-gray-500">Te contactÄƒm imediat ce revenim la birou.</p>
    </div>
    
    <!-- Footer Link -->
    <div class="text-center mt-6 pt-4 border-t border-gray-100">
         <a href="https://whtc.ro" target="_blank" class="text-xs text-gray-500 border-b border-dotted border-gray-500 hover:text-black hover:border-black transition-colors">
            AflÄƒ mai multe despre Safety Academy &rarr;
         </a>
    </div>
  </div>
</FunnelLayout>

<script>
  const form = document.getElementById('reqForm') as HTMLFormElement;
  const iframe = document.getElementById('hidden_iframe_cerere') as HTMLIFrameElement;
  const btn = document.getElementById('reqBtn') as HTMLButtonElement;

  if (form) {
      let submitted = false;
      form.addEventListener('submit', () => {
        submitted = true;
        if(btn) {
            btn.innerText = 'Se trimite...';
            btn.disabled = true;
            btn.style.opacity = '0.7';
        }

        if (typeof (window as any).gtag === 'function') {
            (window as any).gtag('event', 'generate_lead', { 'event_category': 'form', 'event_label': 'request_2026' });
        }
      });
      
      if(iframe) {
        iframe.addEventListener('load', () => {
            if(submitted) {
                window.location.href = '/thank-you';
            }
        });
      }
  }
</script>
