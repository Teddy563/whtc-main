---
import FunnelLayout from '../layouts/FunnelLayout.astro';
---

<FunnelLayout title="Cerere OfertÄƒ 2026 - Safety Academy">
  <div class="bg-white w-full max-w-lg p-6 md:p-10 border-l-8 border-[#FF6B00]">
    <!-- Header -->
    <div class="border-b border-gray-100 pb-6 mb-6">
      <span class="text-[#FF6B00] font-bold text-xs tracking-[0.2em] uppercase block mb-1">
        Safety Academy
      </span>
      <h1 class="text-2xl font-extrabold text-gray-900 m-0">
        Cerere OfertÄƒ 2026
      </h1>
      <p class="text-gray-500 text-sm mt-2">
        Echipa este Ã®n vacanÈ›Äƒ. PreluÄƒm cererile pentru Ianuarie.
      </p>
    </div>

    <!-- Form -->
    <form id="reqForm" class="space-y-4">
      <div>
        <label class="block text-sm font-bold text-gray-700 mb-2">Numele TÄƒu</label>
        <input
          id="inputName"
          type="text"
          required
          class="w-full p-3 border border-gray-300 bg-white text-gray-900 focus:border-[#FF6B00] focus:ring-1 focus:ring-[#FF6B00] outline-none"
        />
      </div>

      <div>
        <label class="block text-sm font-bold text-gray-700 mb-2">Email Business</label>
        <input
          id="inputEmail"
          type="email"
          required
          class="w-full p-3 border border-gray-300 bg-white text-gray-900 focus:border-[#FF6B00] focus:ring-1 focus:ring-[#FF6B00] outline-none"
        />
      </div>

      <div>
        <label class="block text-sm font-bold text-gray-700 mb-2">Telefon</label>
        <input
          id="inputPhone"
          type="tel"
          required
          class="w-full p-3 border border-gray-300 bg-white text-gray-900 focus:border-[#FF6B00] focus:ring-1 focus:ring-[#FF6B00] outline-none"
        />
      </div>

      <div>
        <label class="block text-sm font-bold text-gray-700 mb-2">Detalii Solicitare</label>
        <textarea
          id="inputMsg"
          rows="3"
          required
          placeholder="Ce cursuri vÄƒ intereseazÄƒ?"
          class="w-full p-3 border border-gray-300 bg-white text-gray-900 focus:border-[#FF6B00] focus:ring-1 focus:ring-[#FF6B00] outline-none"
        ></textarea>
      </div>

      <button
        type="submit"
        id="reqBtn"
        class="w-full bg-[#111827] hover:bg-[#FF6B00] text-white font-bold py-3.5 px-4 mt-4 transition-colors duration-300"
      >
        Trimite Cererea
      </button>
    </form>

    <!-- Success Message -->
    <div id="reqSuccess" class="hidden text-center py-8">
      <div class="text-xl font-bold text-gray-900 mb-2">ğŸ‘ Mesaj Primit!</div>
      <p class="text-gray-500">Te contactÄƒm imediat ce revenim la birou.</p>
    </div>
    
    <!-- Footer Link -->
    <div class="text-center mt-6 pt-4 border-t border-gray-100">
         <a href="https://whtc.ro" target="_blank" class="text-xs text-gray-500 border-b border-dotted border-gray-500 hover:text-black hover:border-black transition-colors">
            AflÄƒ mai multe despre Safety Academy &rarr;
         </a>
    </div>
  </div>
</FunnelLayout>

<script>
  // --- CONFIGURARE GOOGLE FORM ---
  const FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSe1N-Oh2HCEfZWnHQF4y5RfCk9azhTeKkh2EjGq2QTXGAriNA/formResponse';
  const ENTRY_NAME = 'entry.720529008';   // Nume
  const ENTRY_EMAIL = 'entry.576847258';  // Email
  const ENTRY_PHONE = 'entry.2114265590';  // Telefon
  const ENTRY_MSG = 'entry.1137760832';    // Detalii
  const ENTRY_SRC = 'entry.268772384';    // Sursa

  const form = document.getElementById('reqForm');
  const successDiv = document.getElementById('reqSuccess');
  const btn = document.getElementById('reqBtn') as HTMLButtonElement | null;
  
  if (form) {
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        if (!btn) return;

        const nameInput = document.getElementById('inputName') as HTMLInputElement;
        const emailInput = document.getElementById('inputEmail') as HTMLInputElement;
        const phoneInput = document.getElementById('inputPhone') as HTMLInputElement;
        const msgInput = document.getElementById('inputMsg') as HTMLInputElement;

        // UI Feedback
        btn.innerText = 'Se trimite...';
        btn.disabled = true;
        btn.style.opacity = '0.7';

        const formData = new FormData();
        formData.append(ENTRY_NAME, nameInput.value);
        formData.append(ENTRY_EMAIL, emailInput.value);
        formData.append(ENTRY_PHONE, phoneInput ? phoneInput.value : '-');
        formData.append(ENTRY_MSG, msgInput.value);
        formData.append(ENTRY_SRC, 'Request Form Medium'); // Auto-filled

        fetch(FORM_URL, {
            method: 'POST',
            mode: 'no-cors',
            body: formData
        })
        .then(() => {
            if (typeof (window as any).gtag === 'function') {
                (window as any).gtag('event', 'generate_lead', { 'event_category': 'form', 'event_label': 'request_2026' });
            }
            window.location.href = '/thank-you';
        })
        .catch(err => {
            console.error(err);
             // Show success anyway on no-cors
            window.location.href = '/thank-you';
        });
      });
  }
</script>
