---
import FunnelLayout from '../layouts/FunnelLayout.astro';
---

<FunnelLayout title="Notificare 2026 - Safety Academy">
  <div class="bg-white w-full max-w-md p-6 md:p-8 border-t-8 border-[#FF6B00]">
    <!-- Brand -->
    <span class="text-[#FF6B00] font-bold text-xs tracking-[0.15em] uppercase block mb-2">
      Safety Academy
    </span>

    <!-- Title -->
    <h1 class="text-3xl font-extrabold text-gray-900 mb-4 leading-tight">
      Start 2026
    </h1>

    <!-- Text -->
    <p class="text-gray-600 mb-6 text-sm leading-relaxed">
      Lasă-ne adresa de email și te anunțăm când revenim din vacanță cu noul calendar.
    </p>

    <!-- Form -->
    <iframe name="hidden_iframe_notificare" id="hidden_iframe_notificare" style="display:none;"></iframe>
    <form 
      id="emailForm" 
      action="https://docs.google.com/forms/d/e/1FAIpQLSe1N-Oh2HCEfZWnHQF4y5RfCk9azhTeKkh2EjGq2QTXGAriNA/formResponse" 
      method="POST" 
      target="hidden_iframe_notificare"
      class="space-y-4"
    >
      <!-- Visible Field -->
      <div>
        <input
          name="entry.576847258"
          id="emailInput"
          type="email"
          required
          placeholder="Adresa ta de email..."
          class="w-full p-3 border border-gray-300 bg-white text-gray-900 focus:border-[#FF6B00] focus:ring-1 focus:ring-[#FF6B00] outline-none transition-colors"
          oninput="document.getElementById('googleEmail').value = this.value" 
        />
      </div>

      <!-- Hidden Fields for Google Form Requirements -->
      <input type="hidden" name="emailAddress" id="googleEmail" /> <!-- Google's "Collect Email" field -->
      <input type="hidden" name="entry.720529008" value="Abonat Newsletter" /> <!-- Name -->
      <input type="hidden" name="entry.2114265590" value="-" />               <!-- Phone -->
      <input type="hidden" name="entry.1137760832" value="Abonare simpla" />  <!-- Details -->
      <input type="hidden" name="entry.268772384" value="Email Low Friction Funnel" /> <!-- Source -->

      <button
        type="submit"
        id="submitBtn"
        class="w-full bg-[#FF6B00] hover:bg-[#e66000] text-white font-bold py-3 px-4 transition-colors duration-200"
      >
        Anunță-mă
      </button>

      <p class="text-xs text-gray-400 mt-4 text-center">
        Fără spam. Doar noutăți despre cursuri.
      </p>
    </form>

    <!-- Success Message -->
    <div id="success" class="hidden text-center py-6">
      <div class="text-green-600 text-4xl mb-2">✓</div>
      <div class="text-green-600 font-bold text-lg">Ești pe listă!</div>
      <div class="text-gray-500 text-sm mt-1">Mulțumim.</div>
    </div>
  </div>
</FunnelLayout>

<script>
  const form = document.getElementById('emailForm') as HTMLFormElement;
  const iframe = document.getElementById('hidden_iframe_notificare') as HTMLIFrameElement;
  const btn = document.getElementById('submitBtn') as HTMLButtonElement;

  if (form) {
    let submitted = false;
    
    form.addEventListener('submit', () => {
      submitted = true;
      if(btn) {
          btn.innerText = 'Se trimite...';
          btn.disabled = true;
          btn.style.opacity = '0.7';
      }
      
      // Track Event immediately
      if (typeof (window as any).gtag === 'function') {
           (window as any).gtag('event', 'generate_lead', { 'event_category': 'form', 'event_label': 'email_2026' });
      }
    });

    if (iframe) {
        iframe.addEventListener('load', () => {
            if(submitted) {
                // If the iframe reloads after we submitted, it means the form went through
                window.location.href = '/thank-you';
            }
        });
    }
  }
</script>
